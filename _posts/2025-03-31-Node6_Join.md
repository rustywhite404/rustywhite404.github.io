---
title: Node.jsë¡œ íšŒì›ê°€ì… í•˜ê¸°(ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”) 6          
date: 2025-03-31 17:10:54
categories: NodeJS         
published: true 
tags:
- NodeJS         
---  

[ğŸ™‹â€â™‚ï¸1. Node.jsë¡œ 5ë¶„ë§Œì— API ë§Œë“¤ê¸°](https://rustywhite404.github.io/nodejs/2025/02/25/Hi_Node/#)  
[ğŸ™‹â€â™‚ï¸2. Node.jsë¡œ POST API ë§Œë“¤ê¸°](https://rustywhite404.github.io/nodejs/2025/02/26/Hi_Node2_Post/#)  
[ğŸ™‹â€â™‚ï¸3. Node.jsë¡œ ë°ì´í„° ì €ì¥í•˜ê¸°](https://rustywhite404.github.io/nodejs/2025/02/27/Hi_Node3_DataSave/#)  
[ğŸ™‹â€â™‚ï¸4. Node.jsì— ì €ì¥ëœ ë°ì´í„°ì— ì¸ë±ìŠ¤ ë¶™ì´ê¸°, ë°ì´í„° ì‚­ì œí•˜ê¸°](https://rustywhite404.github.io/nodejs/2025/03/01/Hi_Node4_CountId/#)  
[ğŸ™‹â€â™‚ï¸5. Node.jsë¡œ ì„¸ì…˜ ë°©ì‹ ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸°](https://rustywhite404.github.io/nodejs/2025/03/18/Hi_Node5_Login/)  
ì´ë²ˆì—ëŠ” ë¯¸ë¤„ë’€ë˜ íšŒì›ê°€ì… ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ì. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í•˜ëŠ” ë°©ë²•ë„ í•¨ê»˜ ì•Œì•„ë³´ê² ë‹¤. ì•”í˜¸í™”ì—ëŠ” ë‹¨ë°©í–¥ í•´ì‹œí•¨ìˆ˜ `bcrypt`ë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë‹¤. 

### ì‚¬ì „ ì¤€ë¹„ 1 : ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜            
```bash 
npm install bcrypt
```  
ì´ë²ˆì—ë„ ìƒˆë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì•¼ í•œë‹¤. bcryptë¥¼ ì„¤ì¹˜í•˜ì.   

### ì‚¬ì „ ì¤€ë¹„ 2 : ì„¤ì¹˜í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ require  
```javascript 
const bcrypt = require('bcrypt');
```  
ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì„¤ì¹˜í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ server.js ìƒë‹¨ì— ì´ë ‡ê²Œ ì„ ì–¸ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤. 

### ì‚¬ì „ ì¤€ë¹„ 3 : join.ejs íŒŒì¼ ë§Œë“¤ê¸°   
ì•ì— ì“´ ê±°ë‘ ë„ˆë¬´ ë˜‘ê°™ì•„ì„œ ê·¸ëƒ¥ ìƒëµí•´ë„ ë  ê²ƒ ê°™ì§€ë§Œ ì¼ë‹¨ ì“´ë‹¤. join.ejsíŒŒì¼ì„ ë§Œë“¤ì–´ì„œ /joinìœ¼ë¡œ idì™€ pwë¥¼ ì „ì†¡í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ì. 

```js 
<body>
    <%- include('nav.html') %>
    <div class="container mt-5">
      <form action="/join" method="POST">
        <h3>Join</h3>
        <div class="form-group">  
          <h5 class="mt-4">ì•„ì´ë””</h5> 
          <input class="form-control form-control-sm" type="text" placeholder="id" name="id">
        </div>
        <div class="form-group"> 
          <h5 class="mt-4">ë¹„ë°€ë²ˆí˜¸</h5>
          <input class="form-control form-control-sm" type="password" placeholder="password" name="pw">
        </div>
          <button type="submit" class="btn btn-primary" data-toggle="button" aria-pressed="false">
          ì €ì¥í•˜ê¸°
        </button>
      </form>
    </div>
    (...)
</body>
``` 

### ê°œë°œ 1 : ë¼ìš°í„° ì‘ì„± & íšŒì›ê°€ì… ë¡œì§ êµ¬í˜„     
GET, POST ë°©ì‹ í˜¸ì¶œ ëª¨ë‘ ì‘ì„±í•´ì¤€ë‹¤. POSTë¡œ idì™€ pwë¥¼ ë³´ë‚¼ ë•ŒëŠ” ì•„ë˜ì˜ ì ˆì°¨ë¥¼ ê±°ì³ì•¼ í•œë‹¤. `ì•„ì´ë”” ì¤‘ë³µ ì—¬ë¶€ í™•ì¸ -> ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” -> DBì— ì €ì¥`. ì‹¤íŒ¨í–ˆì„ ë•ŒëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë¦¬í„´í•˜ë„ë¡ í–ˆë‹¤. bcrypt.hash(pw, 10)ì˜ hash ê°•ë„ëŠ” 10ìœ¼ë¡œ ì„¤ì •í–ˆëŠ”ë° ë³´í†µ 10-12 ì •ë„ë¡œ ì„¤ì •í•œë‹¤.  

```js 
app.get('/join', function(ìš”ì²­, ì‘ë‹µ){
    ì‘ë‹µ.render('join.ejs'); 
})

app.post('/join', async (req, res) => {
    try {
        const { id, pw } = req.body;

        // 1ï¸âƒ£ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì¸ì§€ í™•ì¸
        const existingUser = await db.collection('login').findOne({ id });
        if (existingUser) {
            console.warn('âš ï¸ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤:', id);
            return res.status(400).send('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
        }

        // 2ï¸âƒ£ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
        const hash = await bcrypt.hash(pw, 10); // ë‘ ë²ˆì§¸ ì¸ì 10 â†’ í•´ì‹œ ê°•ë„ (saltRounds)

        // 3ï¸âƒ£ DBì— ì €ì¥
        const result = await db.collection('login').insertOne({ id, pw: hash });
        console.log('âœ… íšŒì›ê°€ì… ì™„ë£Œ:', result);

        res.redirect('/'); // íšŒì›ê°€ì… í›„ í™ˆìœ¼ë¡œ ì´ë™
    } catch (error) {
        console.error('âŒ íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
        res.status(500).send('íšŒì›ê°€ì… ì‹¤íŒ¨!');
    }    
});
``` 

### ê°œë°œ 2 : ë¡œê·¸ì¸ ì‹œ ì•”í˜¸í™” ëœ ê°’ ë¹„êµí•˜ë„ë¡ ìˆ˜ì •  
ê¸°ì¡´ ì½”ë“œì—ëŠ” ë°”ë¡œ pwë¥¼ í‰ë¬¸ ëŒ€ì¡°í•˜ë„ë¡ ë˜ì–´ ìˆì—ˆì§€ë§Œ ì´ì œ ì•”í˜¸í™” ëœ ê°’ë¼ë¦¬ ë¹„êµí•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ë¡œê·¸ì¸ ë¶€ë¶„ êµ¬í˜„ì—ì„œ ì‘ì„±í•´ë‘ì—ˆë˜ ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì£¼ì.  
```js 
passport.use(new LocalStrategy({
    usernameField: 'id',
    passwordField: 'pw',
    session: true,
    passReqToCallback: false,
}, async function (ì…ë ¥í•œì•„ì´ë””, ì…ë ¥í•œë¹„ë²ˆ, done) {
    try {
        const ê²°ê³¼ = await db.collection('login').findOne({ id: ì…ë ¥í•œì•„ì´ë”” });
        if (!ê²°ê³¼) {
            return done(null, false, { message: 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.' });
        }

        // ë¹„ë°€ë²ˆí˜¸ ë¹„êµ â†’ bcrypt.compare() ì‚¬ìš©
        const isMatch = await bcrypt.compare(ì…ë ¥í•œë¹„ë²ˆ, ê²°ê³¼.pw);
        if (isMatch) {
            return done(null, ê²°ê³¼); // ë¡œê·¸ì¸ ì„±ê³µ
        } else {
            return done(null, false, { message: 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.' });
        }
    } catch (error) {
        return done(error);
    }
}));
```  

ì´ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™” í•´ì„œ íšŒì›ê°€ì…ì„ í•˜ê³ , ì•”í˜¸í™” ëœ ê°’ë¼ë¦¬ ë¹„êµí•´ì„œ ë¡œê·¸ì¸ì„ ì‹œí‚¬ ìˆ˜ ìˆë‹¤. 